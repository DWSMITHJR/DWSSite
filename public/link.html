<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Request an access code to view documents in Donald W. Smith Jr.'s portfolio. Secure and private document access.">
    <meta name="author" content="Donald W. Smith Jr.">
    <meta name="keywords" content="access code, document access, secure documents, portfolio access, code generator">
    <meta name="theme-color" content="#ffffff">
    
    <title>Request Access Code | Donald W. Smith Jr.</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="css/code-generator.css" as="style">
    <link rel="preload" href="images/DLogo.jpg" as="image">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css" media="all">
    <link rel="stylesheet" href="css/shared-forms.css" media="all">
    <link rel="stylesheet" href="css/code-generator.css" media="all">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Request Access Code",
        "description": "Secure form to request access to documents in Donald W. Smith Jr.'s portfolio",
        "publisher": {
            "@type": "Person",
            "name": "Donald W. Smith Jr."
        },
        "potentialAction": {
            "@type": "Action",
            "name": "Request Access Code",
            "target": "#accessCodeForm"
        }
    }
    </script>
</head>
<body class="code-generator-page">
    <!-- Skip to main content link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Animated Background -->
    <div class="bg-particles" id="particles" role="presentation" aria-hidden="true"></div>

    <!-- Header -->
    <header role="banner" itemscope itemtype="https://schema.org/WPHeader">
        <div class="header-content">
            <a href="#home" class="logo" aria-label="Return to Top of Page" title="Return to Top of Page" itemprop="url">
                <img src="images/DLogo.jpg" alt="" class="logo-img" aria-hidden="true" width="50" height="50" loading="lazy">
                <span class="visually-hidden" itemprop="name">Donald W. Smith Jr.</span>
            </a>
            
            <!-- Primary Navigation -->
            <nav id="primary-navigation" class="primary-navigation" aria-label="Primary">
                <ul class="nav-links" role="menubar">
                    <li role="none">
                        <a href="#home" 
                           class="nav-link" 
                           title="Home"
                           aria-label="Home"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üè†</span>
                            <span class="nav-text">Home</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="#contact" 
                           class="nav-link" 
                           title="Contact Information" 
                           aria-label="Contact"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">‚úâÔ∏è</span>
                            <span class="nav-text">Contact</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="link.html" 
                           class="nav-link active" 
                           aria-current="page"
                           title="Current Section: Request Code"
                           aria-label="Request Access Code"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üîë</span>
                            <span class="nav-text">Request Code</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="info.html" 
                           class="nav-link" 
                           title="View Documents" 
                           aria-label="Documents"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üìÑ</span>
                            <span class="nav-text">Documents</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="about.html" 
                           class="nav-link" 
                           title="About This Site" 
                           aria-label="About"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">‚ÑπÔ∏è</span>
                            <span class="nav-text">About</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="suggest.html" 
                           class="nav-link" 
                           title="Make a Suggestion" 
                           aria-label="Suggest"
                           role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üí°</span>
                            <span class="nav-text">Suggest</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="main-content" role="main" tabindex="-1" itemscope itemtype="https://schema.org/WebPageElement">
        <!-- Access Code Generator Section -->
        <section id="email-hash" class="access-code-section" aria-labelledby="access-code-heading" itemscope itemtype="https://schema.org/WebPageElement">
            <div class="container">
                <div class="access-code-container">
                    <div class="section-header" role="region" aria-labelledby="access-code-heading access-code-subtitle">
                        <div class="icon-container" aria-hidden="true">
                            <span class="icon-lock">üîí</span>
                        </div>
                        <h2 id="access-code-heading" class="section-title fade-in" itemprop="headline">Access Code Generator</h2>
                        <p id="access-code-subtitle" class="section-subtitle fade-in">Enter your email to receive a secure access code</p>
                    </div>
                    
                    <div class="form-container fade-in" role="region" aria-labelledby="access-form-heading">
                        <div class="form-card" itemscope itemtype="https://schema.org/Form">
                            <h3 id="access-form-heading" class="visually-hidden">Request Access Code Form</h3>
                            
                            <form id="emailForm" class="email-form" novalidate>
                                <div class="form-group" role="group" aria-labelledby="email-label">
                                    <div class="form-field">
                                        <label for="email" id="email-label" class="form-label">
                                            <span class="label-text">Email Address</span>
                                            <span class="required-indicator" aria-hidden="true">*</span>
                                            <span class="visually-hidden">required</span>
                                        </label>

                                        <div class="input-wrapper">
                                            <input type="email" 
                                                   id="email" 
                                                   name="email" 
                                                   required 
                                                   aria-required="true"
                                                   autocomplete="email"
                                                   inputmode="email"
                                                   placeholder="Enter your email address" 
                                                   class="form-input"
                                                   aria-describedby="email-hint emailError">
                                        </div>
                                        <div id="email-hint" class="form-hint"></div>
                                        <div id="emailError" class="error-message" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" 
                                            class="btn btn-primary btn-block"
                                            aria-label="Generate access code">
                                        <span class="btn-icon" aria-hidden="true">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                            </svg>
                                        </span>
                                        <span class="btn-text">Generate Access Code</span>
                                    </button>
                                </div>
                            </form>
                            
                            <!-- Result Container (initially hidden) -->
                            <div class="result-container" 
                                 id="resultContainer" 
                                 role="region" 
                                 aria-live="polite"
                                 aria-label="Generated access code"
                                 style="display: none;">
                                <div class="result-header">
                                    <div class="result-icon" aria-hidden="true">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                            <line x1="12" y1="2" x2="12" y2="22"></line>
                                            <line x1="2" y1="12" x2="22" y2="12"></line>
                                        </svg>
                                    </div>
                                    <h4 class="result-title">Your Secure Access Code</h4>
                                    <p class="result-subtitle">Use this 6-digit code to access the documents</p>
                                </div>
                                
                                <div class="result-wrapper">
                                    <div class="hash-result-wrapper">
                                        <div class="hash-result" 
                                             id="hashResult" 
                                             role="status" 
                                             aria-live="polite"
                                             aria-atomic="true">
                                            <!-- Code will be inserted here -->
                                        </div>
                                        <button type="button" 
                                                class="copy-btn" 
                                                id="copyBtn" 
                                                aria-label="Copy code to clipboard"
                                                title="Copy to clipboard"
                                                data-copied="false">
                                            <span class="btn-content">
                                                <span class="copy-icon" aria-hidden="true">
                                                    <svg class="copy-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                                    </svg>
                                                </span>
                                                <span class="copy-text">Copy Code</span>
                                            </span>
                                            <span class="btn-content copied" aria-hidden="true">
                                                <span class="copied-icon">
                                                    <svg class="check-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <polyline points="20 6 9 17 4 12"></polyline>
                                                    </svg>
                                                </span>
                                                <span>Copied!</span>
                                            </span>
                                        </button>
                                    </div>
                                    
                                    <!-- Removed Request New Code button as per user request -->
                                </div>
                            </div>
                            
                            <div class="form-footer" role="contentinfo">
                                <div class="privacy-notice">
                                    <p class="privacy-text">

                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                            </svg>
                                        Your email is only used to generate a unique access code and will not be stored or used for any other purpose. 
                                        <a href="privacy.html" class="privacy-link">Learn more about our privacy policy</a>.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="contact" role="contentinfo" itemscope itemtype="https://schema.org/WPFooter">
        <div class="footer-container">
            <div class="footer-content">
                <!-- Contact Section -->
                <section class="footer-section" aria-labelledby="contact-heading">
                    <h3 id="contact-heading" class="footer-heading">
                        <span class="emoji" aria-hidden="true">üöÄ</span>
                        <span>Contact & Legal Information</span>
                    </h3>
                    <div class="footer-social" role="navigation" aria-label="Contact methods">
                        <a href="https://linkedin.com/in/donaldwsmithjr"
                           target="_blank"
                           rel="noopener noreferrer"
                           aria-label="Connect on LinkedIn"
                           class="social-link">
                            <span class="social-icon" aria-hidden="true">üîó</span>
                            <span class="social-text">LinkedIn</span>
                        </a>
                        <a href="https://github.com/DWSMITHJR"
                           target="_blank"
                           rel="noopener noreferrer"
                           aria-label="View GitHub profile"
                           class="social-link">
                            <span class="social-icon" aria-hidden="true">üêô</span>
                            <span class="social-text">GitHub</span>
                        </a>
                        <a href="mailto:architect@donaldwsmithjr.com"
                           aria-label="Send email to Donald W. Smith Jr."
                           class="social-link">
                            <span class="social-icon" aria-hidden="true">üìß</span>
                            <span class="social-text">Email</span>
                        </a>
                    </div>
                </section>

                <!-- Legal & Copyright -->
                <div class="footer-legal" role="contentinfo">
                    <p class="copyright">
                        &copy; <span itemprop="copyrightYear">2025</span>
                        <span itemprop="copyrightHolder" itemscope itemtype="https://schema.org/Person">
                            <span itemprop="name">Donald W. Smith Jr.</span>
                        </span>
                        <span class="divider" aria-hidden="true">|</span>
                        <a href="privacy.html" class="legal-link">Privacy Policy</a>
                        <span class="divider" aria-hidden="true">|</span>
                        <a href="terms.html" class="legal-link">Terms of Service</a>
                    </p>
                    <p class="tagline">
                        Built with <span class="heart" aria-label="love">‚ù§Ô∏è</span> for innovation
                        <span class="divider" aria-hidden="true">|</span>
                        Solving the future, one success after another
                    </p>

            <!-- Structured Data for Organization -->
            <script type="application/ld+json">
            {
                "@context": "https://schema.org",
                "@type": "Organization",
                "name": "Donald W. Smith Jr. Portfolio",
                "url": "https://donaldwsmithjr.com",
                "logo": "https://donaldwsmithjr.com/images/DLogo.png",
                "sameAs": [
                    "https://linkedin.com/in/donaldwsmithjr",
                    "https://github.com/DWSMITHJR"
                ]
            }
            </script>
        </div>
    </footer>

    <!-- Build Info -->
    <div class="build-info" style="background: rgba(0, 0, 0, 0.2); padding: 1rem 0; text-align: center;">
        <div class="build-info-container" id="build-info" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
            <span class="build-info-item" style="color: #666; font-family: monospace; font-size: 0.8rem;">
                Build: 20251009.222439 | Oct 9, 2025, 10:24 PM EDT
            </span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js" defer></script>
    <script src="js/api.js" defer></script>
    <script src="js/build-info.js" defer></script>
    <script src="js/tracking.js" defer></script>
    <script src="js/main.js" defer></script>

    <script>
        // These functions are now available globally from auth.js
        
        document.addEventListener('DOMContentLoaded', function() {
            const emailForm = document.getElementById('emailForm');
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            const resultContainer = document.getElementById('resultContainer');
            const hashResult = document.getElementById('hashResult');
            const copyBtn = document.getElementById('copyBtn');
            const resetBtn = document.getElementById('resetBtn');

            // Initialize the form
            function initForm() {
                console.log('Initializing form...');
                
                // Check if auth.js functions are available
                if (typeof generateAccessCode !== 'function' || 
                    typeof saveAuthData !== 'function' || 
                    typeof isValidEmail !== 'function' ||
                    typeof logEvent !== 'function') {
                    const errorMsg = 'Required auth.js functions are not available';
                    console.error(errorMsg);
                    logEvent(LOG_LEVEL.ERROR, errorMsg, { 
                        hasGenerateAccessCode: typeof generateAccessCode === 'function',
                        hasSaveAuthData: typeof saveAuthData === 'function',
                        hasIsValidEmail: typeof isValidEmail === 'function',
                        hasLogEvent: typeof logEvent === 'function'
                    });
                    alert('Error: Required scripts not loaded. Please open this page through a web server.');
                    return;
                }
                
                // Clear any existing results
                resultContainer.style.display = 'none';
                emailForm.reset();
                
                // Set up form submission
                emailForm.addEventListener('submit', handleFormSubmit);
                
                // Set up copy button
                if (copyBtn) {
                    copyBtn.addEventListener('click', copyToClipboard);
                }
                
                console.log('Form initialization complete');
                logEvent(LOG_LEVEL.INFO, 'Access code form initialized', {
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString()
                });
            }

            // Handle form submission
            async function handleFormSubmit(e) {
                e.preventDefault();
                console.log('Form submitted');
                
                const email = emailInput.value.trim();
                console.log('Email entered:', email);
                
                // Log the access code request attempt
                logEvent(LOG_LEVEL.ACCESS, 'Access code requested', { 
                    email,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                });
                
                // Validate email
                if (!email) {
                    const errorMsg = 'No email provided';
                    console.log(errorMsg);
                    logEvent(LOG_LEVEL.WARN, errorMsg);
                    showError(emailInput, emailError, 'Please enter your email address');
                    return;
                }
                
                if (!isValidEmail(email)) {
                    const errorMsg = 'Invalid email format';
                    console.log(errorMsg);
                    logEvent(LOG_LEVEL.WARN, errorMsg, { email });
                    showError(emailInput, emailError, 'Please enter a valid email address');
                    return;
                }
                
                console.log('Generating access code for email:', email);
                
                try {
                    // Generate and display the access code
                    const accessCode = generateAccessCode(email);
                    console.log('Generated access code:', accessCode);
                    
                    // Update the UI
                    hashResult.textContent = accessCode;
                    
                    // Store the authentication data
                    const saveResult = saveAuthData(email, accessCode);
                    if (saveResult) {
                        console.log('Auth data saved to localStorage');
                        logEvent(LOG_LEVEL.ACCESS, 'Access code generated and saved', {
                            email,
                            code: accessCode,
                            timestamp: new Date().toISOString()
                        });
                    } else {
                        throw new Error('Failed to save auth data');
                    }
                    
                    // Show the result
                    resultContainer.style.display = 'flex';
                    resultContainer.scrollIntoView({ behavior: 'smooth' });
                    
                    // Show success message
                    showSuccess('Access code generated successfully!');
                    
                } catch (error) {
                    console.error('Error generating access code:', error);
                    logEvent(LOG_LEVEL.ERROR, 'Error generating access code', {
                        email,
                        error: error.message,
                        stack: error.stack,
                        timestamp: new Date().toISOString()
                    });
                    showError(emailInput, emailError, 'An error occurred. Please try again.');
                }
            }
            
            // Copy code to clipboard
            async function copyToClipboard() {
                if (!hashResult.textContent) return;
                
                try {
                    await navigator.clipboard.writeText(hashResult.textContent);
                    
                    // Update button state
                    const copyIcon = copyBtn.querySelector('.copy-icon');
                    const copyText = copyBtn.querySelector('.copy-text');
                    
                    copyBtn.classList.add('copied');
                    copyText.textContent = 'Copied!';
                    
                    // Log the copy action
                    logEvent(LOG_LEVEL.ACCESS, 'Access code copied to clipboard', {
                        code: hashResult.textContent,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Revert after 2 seconds
                    setTimeout(() => {
                        copyBtn.classList.remove('copied');
                        copyText.textContent = 'Copy Code';
                    }, 2000);
                    
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    logEvent(LOG_LEVEL.ERROR, 'Failed to copy access code', {
                        error: err.message,
                        timestamp: new Date().toISOString()
                    });
                    showError(null, null, 'Failed to copy code');
                }
            }
            
            // Show error message
            function showError(input, errorElement, message) {
                console.log('Showing error:', message, {input, errorElement});
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                    console.log('Error element updated:', errorElement);
                }
                if (input) {
                    input.classList.add('error');
                    input.focus();
                    console.log('Input marked as error:', input);
                }
            }
            
            // Show success message
            function showSuccess(message) {
                console.log('Success:', message);
                // You could add a toast notification here
            }
            
            // Initialize the form when the DOM is fully loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initForm);
            } else {
                initForm();
            }
        });
    </script>
</body>
</html>
