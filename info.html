<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Document library for Donald W. Smith Jr.'s portfolio. Access professional documents, certifications, and resources.">
    <meta name="author" content="Donald W. Smith Jr.">
    <meta name="keywords" content="document library, portfolio, certifications, professional documents, resources">
    <meta name="theme-color" content="#ffffff">
    
    <title>Document Library | Donald W. Smith Jr.</title>
    
    <!-- Favicon (base64 encoded to prevent 404) -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AkEEjIXDlQhNQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAGUlEQVQ4y2NgGAWjYAQBExMTEwPJgAEAHp4B8ZtDqo0AAAAASUVORK5CYII=">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="preload" href="css/documents.css" as="style">
    <link rel="preload" href="images/DLogo.jpg" as="image">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css" media="all">
    <link rel="stylesheet" href="css/components/documents.css" media="all">
    <link rel="stylesheet" href="css/shared-forms.css" media="all">
    <link rel="stylesheet" href="css/documents.css" media="all">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Document Library",
        "description": "Collection of professional documents and resources",
        "itemListOrder": "https://schema.org/ItemListOrderDescending",
        "creator": {
            "@type": "Person",
            "name": "Donald W. Smith Jr."
        }
    }
    </script>
<body>
    <!-- Animated Background -->
    <div class="bg-particles" id="particles"></div>

    <!-- Skip to Main Content Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header -->
    <header class="site-header" role="banner">
        <div class="header-content" itemscope itemtype="https://schema.org/Person">
            <a href="index.html" class="logo" aria-label="Return to Home Page" title="Return to Home Page" itemprop="url">
                <img src="images/DLogo.jpg" alt="Donald W. Smith Jr. - Professional Portfolio" class="logo-img" width="50" height="50" loading="lazy" itemprop="image">
            </a>
            
            <!-- Mobile Menu Toggle -->
            <button class="menu-toggle" 
                    id="mobile-menu-toggle" 
                    aria-expanded="false" 
                    aria-controls="primary-navigation"
                    aria-label="Toggle navigation menu">
                <span class="menu-toggle-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Menu</span>
            </button>
            
            <!-- Primary Navigation -->
            <nav id="primary-navigation" class="primary-navigation" aria-label="Primary">
                <ul class="nav-links" role="menubar">
                    <li role="none">
                        <a href="index.html" class="nav-link" title="Navigate to Home Page" aria-label="Home" role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üè†</span>
                            <span class="nav-text">Home</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="link.html" class="nav-link" title="Request Access Code" aria-label="Request Access Code" role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üîë</span>
                            <span class="nav-text">Request Code</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="info.html" class="nav-link active" aria-current="page" title="Current Page: Documents" role="menuitem">
                            <span class="nav-icon" aria-hidden="true">üìÇ</span>
                            <span class="nav-text">Documents</span>
                        </a>
                    </li>
                    <li role="none">
                        <a href="about.html" class="nav-link" title="About This Site" aria-label="About" role="menuitem">
                            <span class="nav-icon" aria-hidden="true">‚ÑπÔ∏è</span>
                            <span class="nav-text">About</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="main-content" role="main" tabindex="-1" itemscope itemtype="https://schema.org/CollectionPage">
        <!-- Login Form Section -->
        <section id="login-section" class="access-code-section" aria-labelledby="login-heading" itemscope itemtype="https://schema.org/WebPageElement">
            <div class="container">
                <div class="access-code-container">
                    <div class="section-header" role="region" aria-labelledby="login-heading login-subtitle">
                        <div class="icon-container" aria-hidden="true">
                            <span class="icon-lock">üîí</span>
                        </div>
                        <h1 id="login-heading" class="section-title fade-in" itemprop="headline">Document Library</h1>
                        <p id="login-subtitle" class="section-subtitle fade-in">Secure access to professional documents</p>
                    </div>
                    
                    <div class="form-container fade-in" role="region" aria-labelledby="login-form-heading">
                        <div class="form-card" itemscope itemtype="https://schema.org/Form">
                            <h2 id="login-form-heading" class="visually-hidden">Document Access Form</h2>
                            
                            <form id="loginForm" class="login-form" novalidate>
                                <div class="form-group" role="group" aria-labelledby="email-label">
                                    <div class="form-field">
                                        <label for="loginEmail" id="email-label" class="form-label">
                                            <span class="label-text">Email Address</span>
                                            <span class="required-indicator" aria-hidden="true">*</span>
                                            <span class="visually-hidden">required</span>
                                        </label>

                                        <div class="input-wrapper">
                                            <input type="email" 
                                                   id="loginEmail" 
                                                   name="email" 
                                                   required 
                                                   autocomplete="email"
                                                   aria-required="true"
                                                   inputmode="email"
                                                   placeholder="your.email@example.com" 
                                                   class="form-input"
                                                   aria-describedby="emailHelp emailError">
                                        </div>
                                        <div id="emailHelp" class="form-hint">Enter the email address associated with your access</div>
                                        <div id="emailError" class="error-message" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>

                                <div class="form-group" role="group" aria-labelledby="code-label">
                                    <div class="form-field">
                                        <label for="accessCode" id="code-label" class="form-label">
                                            <span class="label-text">Access Code</span>
                                            <span class="required-indicator" aria-hidden="true">*</span>
                                            <span class="visually-hidden">required</span>
                                        </label>

                                        <div class="input-wrapper">
                                            <input type="text" 
                                                   id="accessCode" 
                                                   name="accessCode" 
                                                   required 
                                                   inputmode="numeric"
                                                   pattern="\d{6}"
                                                   aria-required="true"
                                                   maxlength="6" 
                                                   placeholder="123456" 
                                                   class="form-input"
                                                   aria-describedby="codeHelp codeError">
                                        </div>
                                        <div id="codeHelp" class="form-hint">Enter the 6-digit code you received</div>
                                        <div id="codeError" class="error-message" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" 
                                            class="btn btn-primary btn-block"
                                            aria-label="Sign in to access documents">
                                        <span class="btn-icon" aria-hidden="true">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M5 12h14"></path>
                                                <path d="M12 5l7 7-7 7"></path>
                                            </svg>
                                        </span>
                                        <span class="btn-text">Sign In</span>
                                    </button>
                                </div>
                                
                                <div class="form-footer">
                                    <p>Don't have an access code? <a href="link.html" class="text-link">Request one here</a>.</p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Document List Section (initially hidden) -->
        <section id="documents-section" class="section documents-section" aria-labelledby="documents-heading" hidden>
            <div class="documents-header">
                <div class="documents-actions">
                    <button id="signOutBtn" class="btn btn-secondary" aria-label="Sign out">
                        <span class="btn-icon" aria-hidden="true">‚Üê</span>
                        <span class="btn-text">Sign Out</span>
                    </button>
                </div>
            </div>
            <div class="documents-container" role="region" aria-labelledby="documents-heading" tabindex="0">
                <!-- Search and Filter Bar -->
                <div class="documents-toolbar">
                    <div class="search-container">
                        <input type="text" id="searchDocuments" class="search-input" placeholder="Search documents..." aria-label="Search documents">
                        <span class="search-icon" aria-hidden="true">üîç</span>
                    </div>
                    <div class="filter-container">
                        <select id="filterDocuments" class="filter-select" aria-label="Filter by document type">
                            <option value="all">All Types</option>
                            <option value="pdf">PDF</option>
                            <option value="doc">Word</option>
                            <option value="xls">Excel</option>
                            <option value="image">Images</option>
                        </select>
                    </div>
                </div>

                <!-- Documents Grid -->
                <div id="documentsGrid" class="documents-grid" aria-live="polite">
                    <!-- Documents will be inserted here by JavaScript -->
                    <div class="document-card loading">
                        <div class="document-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading documents...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="emptyState" class="empty-state" role="alert" aria-live="polite" hidden>
                    <div class="empty-state-content">
                        <span class="empty-state-icon" aria-hidden="true">üìÅ</span>
                        <h3>No Documents Found</h3>
                        <p>There are currently no documents available in the files directory.</p>
                        <button id="refreshDocuments" class="btn btn-primary" aria-label="Refresh document list">
                            <span class="btn-icon" aria-hidden="true">‚ü≥</span>
                            <span class="btn-text">Refresh</span>
                        </button>
                    </div>
                </div>
                </div>
                

            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="js/utils/auth.js"></script>
    <script>
        // Check if user is already authenticated on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if auth.js functions are available
            const requiredFunctions = [
                'getAuthData', 'clearAuthData', 'isValidEmail', 
                'verifyDocumentAccess', 'getUserDocuments', 
                'initializeSampleDocuments', 'saveUserDocuments'
            ];
            
            const missingFunctions = requiredFunctions.filter(fn => typeof window[fn] !== 'function');
            
            if (missingFunctions.length > 0) {
                console.error('Missing required functions:', missingFunctions);
                alert('Error: Required scripts not loaded properly. Please open this page through a web server.');
                return;
            }
            const loginSection = document.getElementById('login-section');
            const documentsSection = document.getElementById('documents-section');
            const loginForm = document.getElementById('loginForm');
            const emailInput = document.getElementById('loginEmail');
            const codeInput = document.getElementById('accessCode'); // Updated ID to match HTML
            const requestCodeBtn = document.getElementById('requestCodeBtn');
            const loginBtn = document.getElementById('loginBtn');
            const signOutBtn = document.getElementById('signOutBtn');
            const documentsList = document.getElementById('documentsList');
            const documentCount = document.getElementById('documentCount');
            const lastUpdated = document.getElementById('lastUpdated');
            const uploadForm = document.getElementById('uploadForm');
            const fileInput = document.getElementById('fileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const searchInput = document.getElementById('searchDocuments');
            const sortSelect = document.getElementById('sortDocuments');
            const filterSelect = document.getElementById('filterDocuments');
            
            let currentUser = null;
            let documents = [];

            // Check authentication status on page load
            function checkAuth() {
                const authData = getAuthData();
                if (authData) {
                    currentUser = authData.email;
                    loadDocuments();
                    showDocumentsSection();
                } else {
                    showLoginSection();
                }
            }

            // Show login section
            function showLoginSection() {
                if (loginSection) loginSection.hidden = false;
                if (documentsSection) documentsSection.hidden = true;
                if (loginForm) loginForm.reset();
            }

            // Show documents section
            function showDocumentsSection() {
                if (loginSection) loginSection.hidden = true;
                if (documentsSection) documentsSection.hidden = false;
                updateDocumentCount();
                updateLastUpdated();
            }

            // Load documents from files directory
            function loadDocuments() {
                if (!currentUser) return;
                
                // List of files in the files directory
                const files = [
                    { 
                        id: 'cover-letter',
                        title: 'Donald Smith Cover Letter',
                        fileType: 'docx',
                        fileSize: '46 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Professional cover letter',
                        path: 'files/Donald Smith Cover Letter.docx'
                    },
                    { 
                        id: 'resume-ats',
                        title: 'Donald Smith Resume (ATS)',
                        fileType: 'docx',
                        fileSize: '53 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Resume optimized for ATS systems',
                        path: 'files/Donald Smith Resume ATS.docx'
                    },
                    { 
                        id: 'resume-detail',
                        title: 'Donald Smith Resume (Detailed)',
                        fileType: 'docx',
                        fileSize: '58 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Comprehensive resume with full work history',
                        path: 'files/Donald Smith Resume Detail.docx'
                    },
                    { 
                        id: 'resume-hr',
                        title: 'Donald Smith Resume (HR)',
                        fileType: 'docx',
                        fileSize: '46 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Resume tailored for human resources',
                        path: 'files/Donald Smith Resume HR.docx'
                    },
                    { 
                        id: 'resume-short',
                        title: 'Donald Smith Resume (Short)',
                        fileType: 'docx',
                        fileSize: '53 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Concise one-page resume',
                        path: 'files/Donald Smith Resume Short.docx'
                    },
                    { 
                        id: 'resume-summary',
                        title: 'Donald Smith Resume (Summary)',
                        fileType: 'docx',
                        fileSize: '56 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Resume with professional summary',
                        path: 'files/Donald Smith Resume Summary.docx'
                    },
                    { 
                        id: 'elevator-speech',
                        title: 'Donald Smith Elevator Speech',
                        fileType: 'docx',
                        fileSize: '13 KB',
                        uploadDate: new Date().toISOString(),
                        description: 'Professional introduction and value proposition',
                        path: 'files/Donald Smith elevator speech.docx'
                    }
                ];
                
                documents = files;
                renderDocuments(documents);
            }

            // Render documents in the UI with modern card layout
            function renderDocuments(docs) {
                const documentsGrid = document.getElementById('documentsGrid');
                if (!documentsGrid) return;
                
                // Clear existing content
                documentsGrid.innerHTML = '';
                
                if (!docs || docs.length === 0) {
                    document.getElementById('emptyState').hidden = false;
                    return;
                }
                
                // Hide empty state if there are documents
                document.getElementById('emptyState').hidden = true;
                
                // Create document cards
                docs.forEach(doc => {
                    const card = document.createElement('div');
                    card.className = 'document-card';
                    card.dataset.id = doc.id;
                    card.dataset.type = doc.fileType ? doc.fileType.toLowerCase() : 'file';
                    
                    // Format file size if it's a number
                    let fileSize = doc.fileSize || 'N/A';
                    if (typeof doc.size === 'number') {
                        fileSize = formatFileSize(doc.size);
                    }
                    
                    // Format upload date
                    const uploadDate = doc.uploadDate || new Date().toISOString();
                    
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="file-icon" data-type="${doc.fileType || 'file'}">
                                ${getFileIcon(doc.fileType || 'file')}
                            </div>
                            <div class="file-actions">
                                <button class="btn-icon" title="Download" data-action="download" data-id="${doc.id}" aria-label="Download ${escapeHtml(doc.title || 'file')}">
                                    <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                                        <path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <h3 class="file-name" title="${escapeHtml(doc.title || doc.fileName || 'Untitled')}">
                                ${escapeHtml(doc.title || doc.fileName || 'Untitled')}
                            </h3>
                            <p class="file-description">
                                ${escapeHtml(doc.description || doc.path || 'No description available')}
                            </p>
                            <div class="file-meta">
                                <span class="file-type">${(doc.fileType || 'FILE').toUpperCase()}</span>
                                <span class="file-size">${fileSize}</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="file-date" data-date="${uploadDate}">
                                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" style="margin-right: 4px;">
                                    <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                                </svg>
                                ${formatDate(uploadDate)}
                            </span>
                        </div>`;
                    
                    documentsGrid.appendChild(card);
                });
                
                // Add event listeners to action buttons
                documentsGrid.querySelectorAll('[data-action]').forEach(btn => {
                    btn.addEventListener('click', handleDocumentAction);
                });
                
                // Initialize search and filter functionality
                initializeSearchAndFilter();
            }

            // Handle document download
            function handleDocumentAction(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const action = e.currentTarget.dataset.action;
                const docId = e.currentTarget.closest('.document-card')?.dataset.id || e.currentTarget.dataset.id;
                
                if (!docId) return;
                
                const doc = documents.find(d => d.id === docId);
                if (!doc) return;
                
                if (action === 'download') {
                    // Add visual feedback
                    const btn = e.currentTarget;
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = `
                        <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M10,17L5,12L6.41,10.58L10,14.17L17.59,6.58L19,8L10,17Z"/>
                        </svg>
                        <span class="btn-text">Downloading...</span>`;
                    
                    downloadDocument(doc).finally(() => {
                        // Revert button state after a short delay
                        setTimeout(() => {
                            btn.innerHTML = originalHTML;
                        }, 2000);
                    });
                }
            }

            // Download a document
            function downloadDocument(doc) {
                if (!doc || !doc.path) {
                    showNotification('Error: Invalid document', 'error');
                    return;
                }
                
                // Create a temporary link element
                const link = document.createElement('a');
                link.href = doc.path;
                link.download = doc.title + '.' + doc.fileType;
                
                // Append to the document
                document.body.appendChild(link);
                
                // Trigger the download
                link.click();
                
                // Clean up
                document.body.removeChild(link);
                
                // Show success message
                showNotification(`Downloading ${doc.title}...`, 'success');
                
                // Log the download
                console.log('Downloading document:', doc.title, 'from', doc.path);
                console.log('Downloading document:', doc);
            }

            // Verify document access for download
            function verifyDocumentAccess(email, code) {
                // This is a wrapper around the auth.js function for convenience
                const auth = getAuthData();
                if (!auth || auth.email !== email) return false;
                
                return code === generateAccessCode(email);
            }

            // Update document count
            function updateDocumentCount() {
                if (documentCount) {
                    const count = documents.length;
                    documentCount.textContent = `${count} ${count === 1 ? 'document' : 'documents'}`;
                }
            }

            // Update last updated time
            function updateLastUpdated() {
                if (lastUpdated) {
                    lastUpdated.textContent = `Last updated: ${formatDate(new Date().toISOString())}`;
                }
            }

            // Get file icon based on file type
            function getFileIcon(fileType) {
                const type = fileType.toLowerCase();
                // Return SVG icons for better quality and theming
                if (type.includes('pdf')) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#e74c3c" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M13,9V3.5L18.5,9H13Z"/>
                    </svg>`;
                if (type.includes('word') || type.includes('doc')) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#2b579a" d="M6,2H14L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M13,3.5V9H18.5L13,3.5M17,11H13V13H15V19H13V21H17V19H15V13H17V11Z"/>
                    </svg>`;
                if (type.includes('excel') || type.includes('xls')) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#217346" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.8,20H14L12,16.6L10,20H8.2L11.1,15.5L8.2,11H10L12,14.4L14,11H15.8L12.9,15.5L15.8,20M13,9V3.5L18.5,9H13Z"/>
                    </svg>`;
                if (type.includes('powerpoint') || type.includes('ppt')) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#d24726" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.2,20H13.8V12.2H15.2V20M13,11H10V9.5H13V11M13.8,9H10V7.2H13.8V9M18,20H16.2V16.5H18V20M18,15.2H16.2V13.4H18V15.2M13,9V3.5L18.5,9H13Z"/>
                    </svg>`;
                if (type.match(/(jpg|jpeg|png|gif|bmp|tiff|webp|svg)$/i)) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#9c27b0" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                    </svg>`;
                if (type.match(/(zip|rar|7z|tar|gz|bz2|xz)$/i)) return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#f39c12" d="M14,13H19V15H14V13M14,9H19V11H14V9M14,17H19V19H14V17M11,13V15H6V13H11M11,9V11H6V9H11M11,17V19H6V17H11M12,3C16.42,3 20,4.79 20,7V17C20,19.21 16.42,21 12,21C7.58,21 4,19.21 4,17V7C4,4.79 7.58,3 12,3M12,5C8.13,5 6,6.5 6,7C6,7.5 8.13,9 12,9C15.87,9 18,7.5 18,7C18,6.5 15.87,5 12,5Z"/>
                    </svg>`;
                
                // Default file icon
                return `
                    <svg class="file-icon-svg" viewBox="0 0 24 24">
                        <path fill="#7f8c8d" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M18,15.2H16.2V13.4H18V15.2M13,9V3.5L18.5,9H13Z"/>
                    </svg>`;
            }

            // Format date for display
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }

            // Escape HTML to prevent XSS
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .toString()
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }

            // Show notification
            function showNotification(message, type = 'info') {
                // In a real app, you might want to implement a proper notification system
                alert(`${type.toUpperCase()}: ${message}`);
            }

            // Handle login form submission
            async function handleLogin(e) {
                e.preventDefault();
                
                const email = emailInput.value.trim();
                const code = codeInput.value.trim();
                
                // Validate inputs
                if (!email || !code) {
                    showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                if (!isValidEmail(email)) {
                    showNotification('Please enter a valid email address', 'error');
                    emailInput.focus();
                    return;
                }
                
                // Verify the code matches the generated one
                const generatedCode = generateAccessCode(email);
                
                if (code === generatedCode) {
                    // Save auth data
                    saveAuthData(email, code);
                    currentUser = email;
                    
                    // Initialize user's documents if they don't exist
                    const userDocs = getUserDocuments(email);
                    if (!userDocs || userDocs.length === 0) {
                        initializeSampleDocuments(email);
                    }
                    
                    showDocumentsSection();
                    loadDocuments();
                    showNotification('Login successful!', 'success');
                } else {
                    showNotification('Invalid access code', 'error');
                    codeInput.focus();
                }
            }

            // Handle logout
            function handleLogout(e) {
                if (e) e.preventDefault();
                clearAuthData();
                currentUser = null;
                documents = [];
                // Force a full page reload to clear any state
                window.location.replace('link.html');
            }

            // Handle request access code
            function handleRequestCode() {
                const email = emailInput.value.trim();
                
                if (!email) {
                    showNotification('Please enter your email address', 'error');
                    emailInput.focus();
                    return;
                }
                
                if (!isValidEmail(email)) {
                    showNotification('Please enter a valid email address', 'error');
                    emailInput.focus();
                    return;
                }
                
                // Generate and display the access code
                const accessCode = generateAccessCode(email);
                
                // In a real app, you would send this code to the user's email
                // For this example, we'll just show it in an alert
                alert(`Your access code is: ${accessCode}\n\n(Note: In a real app, this would be sent to your email)`);
                
                // Enable the code input and login button
                if (codeInput) codeInput.disabled = false;
                if (loginBtn) loginBtn.disabled = false;
                if (codeInput) codeInput.focus();
            }

            // Handle file upload
            function handleFileUpload(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    showNotification('Please log in to upload files', 'error');
                    return;
                }
                
                const file = fileInput?.files?.[0];
                if (!file) {
                    showNotification('Please select a file to upload', 'error');
                    return;
                }
                
                // Create a new document object
                const newDoc = {
                    id: 'doc' + Date.now(),
                    title: file.name.replace(/\.[^/.]+$/, ''), // Remove file extension
                    description: 'Uploaded file',
                    fileName: file.name,
                    fileType: file.name.split('.').pop().toLowerCase(),
                    fileSize: formatFileSize(file.size),
                    uploadDate: new Date().toISOString(),
                    lastModified: new Date(file.lastModified).toISOString()
                };
                
                // Add to documents array
                documents.unshift(newDoc);
                
                // Save to localStorage
                saveUserDocuments(currentUser, documents);
                
                // Update UI
                renderDocuments(documents);
                updateDocumentCount();
                updateLastUpdated();
                
                // Reset the form
                if (uploadForm) uploadForm.reset();
                
                showNotification('File uploaded successfully', 'success');
            }

            // Format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                if (typeof bytes !== 'number') return bytes || 'N/A';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.min(Math.floor(Math.log(bytes) / Math.log(k)), sizes.length - 1);
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // Initialize search and filter functionality
            function initializeSearchAndFilter() {
                const searchInput = document.getElementById('searchDocuments');
                const filterSelect = document.getElementById('filterDocuments');
                
                if (searchInput) {
                    let searchTimeout;
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            searchAndFilter(searchInput.value, filterSelect?.value || 'all');
                        }, 300);
                    });
                }
                
                if (filterSelect) {
                    filterSelect.addEventListener('change', (e) => {
                        searchAndFilter(
                            document.getElementById('searchDocuments')?.value || '',
                            e.target.value
                        );
                    });
                }
            }
            
            // Search and filter documents
            function searchAndFilter(searchQuery = '', fileType = 'all') {
                let filtered = [...documents];
                
                // Apply search filter
                if (searchQuery && searchQuery.trim() !== '') {
                    const searchTerm = searchQuery.toLowerCase();
                    filtered = filtered.filter(doc => 
                        doc.title.toLowerCase().includes(searchTerm) || 
                        (doc.description && doc.description.toLowerCase().includes(searchTerm))
                    );
                }
                
                // Apply file type filter
                if (fileType !== 'all') {
                    filtered = filtered.filter(doc => {
                        const type = doc.fileType.toLowerCase();
                        if (fileType === 'image') {
                            return type.match(/(jpg|jpeg|png|gif|bmp|tiff|webp|svg)$/i);
                        }
                        return type.includes(fileType);
                    });
                }
                
                // Update UI
                const cards = document.querySelectorAll('.document-card');
                const visibleIds = new Set(filtered.map(doc => doc.id));
                
                cards.forEach(card => {
                    if (visibleIds.has(card.dataset.id)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Show/hide empty state
                const visibleCount = filtered.length;
                document.getElementById('emptyState').hidden = visibleCount > 0;
            }

            // Sort documents
            function sortDocuments(criteria) {
                const sorted = [...documents];
                
                switch (criteria) {
                    case 'name-asc':
                        sorted.sort((a, b) => a.title.localeCompare(b.title));
                        break;
                    case 'name-desc':
                        sorted.sort((a, b) => b.title.localeCompare(a.title));
                        break;
                    case 'date-asc':
                        sorted.sort((a, b) => new Date(a.uploadDate) - new Date(b.uploadDate));
                        break;
                    case 'date-desc':
                        sorted.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
                        break;
                    case 'size-asc':
                        sorted.sort((a, b) => parseFloat(a.fileSize) - parseFloat(b.fileSize));
                        break;
                    case 'size-desc':
                        sorted.sort((a, b) => parseFloat(b.fileSize) - parseFloat(a.fileSize));
                        break;
                }
                
                renderDocuments(sorted);
            }

            // Filter documents by type
            function filterDocuments(type) {
                if (!type) {
                    renderDocuments(documents);
                    return;
                }
                
                const filtered = documents.filter(doc => 
                    doc.fileType.toLowerCase() === type.toLowerCase()
                );
                
                renderDocuments(filtered);
            }

            // Event listeners
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            if (requestCodeBtn) {
                requestCodeBtn.addEventListener('click', handleRequestCode);
            }
            
            if (signOutBtn) {
                signOutBtn.addEventListener('click', handleLogout);
            }
            
            if (uploadForm) {
                uploadForm.addEventListener('submit', handleFileUpload);
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchDocuments(e.target.value);
                });
            }
            
            if (sortSelect) {
                sortSelect.addEventListener('change', (e) => {
                    sortDocuments(e.target.value);
                });
            }
            
            if (filterSelect) {
                filterSelect.addEventListener('change', (e) => {
                    filterDocuments(e.target.value);
                });
            }
            
            // Initialize the app
            checkAuth();
        });
    </script>

    <!-- Footer -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-social">
                <a href="https://linkedin.com/in/donaldwsmithjr" class="project-card fade-in" target="_blank" title="LinkedIn">üîó LinkedIn</a>
                <a href="https://github.com/DWSMITHJR" class="project-card fade-in" target="_blank" title="GitHub">üêô GitHub</a> 
                <a href="mailto:architect@donaldwsmithjr.com" class="project-card fade-in" title="Email">üìß Email</a>
            </div>
            <div class="footer-text">
                <p>&copy; 2025 Donald W. Smith Jr. | <a href="privacy.html">Privacy Policy</a> | <a href="terms.html">Terms of Service</a></p>
                <p>Built with passion for innovation | Solving the future, one success after another</p>
            </div>
        </div>
    </footer>
</body>
</html>
